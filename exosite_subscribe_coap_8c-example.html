<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Exosite Ready SDK: exosite_subscribe_coap.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="EXOSITE-ready.logo-sheet.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Exosite Ready SDK
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('exosite_subscribe_coap_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">exosite_subscribe_coap.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example demonstrates how to subscribe to a data resource on the server over HTTP. It subscribes to the "Dev1" data resource, show a message when its value is updated. (For example a new value is set on the OpenTether portal)</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Make sure that the "Dev1" data resource is added to your device on the Exosite OpenTether portal.</li>
</ul>
</dd>
<dd>
<ul>
<li>If your device has not been activated, the activation process will be performed when this example runs first time. The given CIK will be stored in the device's permanent memory. Later this stored CIK will be used for the communication.</li>
</ul>
</dd>
<dd>
<ul>
<li>Make sure that your device does not store an invalid CIK in its permanent storage. (For example the device was activated before, but the assigned device on the OpenTeter portal has been deleted). If it does, you have to clear it to enforce a new activation process.</li>
</ul>
</dd></dl>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="type_8h.html">lib/type.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="error_8h.html">lib/error.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="debug_8h.html">lib/debug.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="exosite__api_8h.html">exosite_api.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <a name="a0"></a><a class="code" href="exosite__subscribe__coap_8c.html#a6b8e22f298c5bf38d1396a2da5c70eac">on_change</a>(<span class="keywordtype">int</span> status, <span class="keyword">const</span> <span class="keywordtype">char</span> *alias, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> BOOL notify_state = FALSE;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status == ERR_SUCCESS) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Value changed on server \&quot;%s\&quot; to %s\n&quot;</span>, alias, value);</div>
<div class="line">        notify_state = !notify_state;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a name="a1"></a><a class="code" href="exosite__subscribe__coap_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a2"></a><a class="code" href="structexosite__class.html">exosite_class</a> *exo;</div>
<div class="line">    <span class="keywordtype">int</span> error;</div>
<div class="line">    <span class="keyword">enum</span> exosite_device_status status;</div>
<div class="line">    <span class="keywordtype">char</span> *vendor, *model, *sn;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 4) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Please specify the VENDOR, MODEL, SERIAL_NUMBER of your device and run again\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Without VENDOR, MODEL, SERIAL_NUMBER the test cannot connect connect to the Exosite cloud\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ERR_FAILURE;</div>
<div class="line">    }</div>
<div class="line">    vendor = argv[1];</div>
<div class="line">    model = argv[2];</div>
<div class="line">    sn = argv[3];</div>
<div class="line"></div>
<div class="line">    error = <a name="a3"></a><a class="code" href="group___exosite___a_p_i.html#gaac628db55f159c64251584ef611d6ef1">exosite_sdk_init</a>(printf, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (error)</div>
<div class="line">        <span class="keywordflow">return</span> ERR_FAILURE;</div>
<div class="line"></div>
<div class="line">    info_log(DEBUG_APPLICATION, (<span class="stringliteral">&quot;Coap subscribe example\n&quot;</span>));</div>
<div class="line"></div>
<div class="line">    error = <a name="a4"></a><a class="code" href="group___exosite___a_p_i.html#ga70278e356b752eba1ee606a725aec40b">exosite_new</a>(&amp;exo, vendor, model, sn, APP_PROTO_COAP);</div>
<div class="line">    <span class="keywordflow">if</span> (error)</div>
<div class="line">        <span class="keywordflow">return</span> ERR_FAILURE;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        status = <a name="a5"></a><a class="code" href="group___exosite___a_p_i.html#ga1a5c5601699db951d116d0cf7e4c38a1">exosite_get_status</a>(exo);</div>
<div class="line">        <a name="a6"></a><a class="code" href="group___exosite___a_p_i.html#gab8edb09e2a237927624249c76dbf99a4">exosite_delay_and_poll</a>(exo, 200);</div>
<div class="line">    } <span class="keywordflow">while</span> (status != DEVICE_STATUS_ACTIVATED);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        error = <a name="a7"></a><a class="code" href="group___exosite___a_p_i.html#ga245a9bf0809e30f4bf79a259ca8c9778">exosite_subscribe</a>(exo, <span class="stringliteral">&quot;led&quot;</span>, 0, <a class="code" href="exosite__subscribe__coap_8c.html#a6b8e22f298c5bf38d1396a2da5c70eac">on_change</a>);</div>
<div class="line">    } <span class="keywordflow">while</span> (error);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">        <a name="a8"></a><a class="code" href="group___exosite___a_p_i.html#ga2681b5ce3d505b037ded36df8bab15ef">exosite_poll</a>(exo);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> ERR_SUCCESS;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
